<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Dekha — Roshni</title>
<link rel="preload" href="chime.mp3" as="audio">
<style>
 :root{
   --text-color:#fff;
   --glow-a: rgba(255,230,170,0.95);
   --glow-b: rgba(255,150,60,0.70);
   --bg-dark: #010101;
 }
 html,body{height:100%;margin:0;background:var(--bg-dark);font-family:Inter,system-ui,Arial;color:var(--text-color);}
 #app{position:relative;height:100vh;overflow:hidden;}
 video#cam{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;transform:scaleX(-1);filter:brightness(0.6) contrast(1.05) saturate(1.05) blur(0.0px);}
 canvas#fx{position:fixed;inset:0;width:100%;height:100%;pointer-events:none;mix-blend-mode:screen;z-index:12}
 .overlay{position:fixed;inset:0;z-index:18;pointer-events:none;}
 .ui{position:fixed;left:50%;transform:translateX(-50%);bottom:28px;text-align:center;z-index:30}
 button#start{background:linear-gradient(180deg,#fffbf2,#fff2d6);color:#111;border-radius:999px;padding:12px 20px;font-size:17px;border:none;box-shadow:0 10px 30px rgba(20,10,0,0.45)}
 .hint{font-size:13px;color:#e8e8e8;margin-top:8px;opacity:0.95}
 .msg{position:fixed;left:50%;transform:translateX(-50%);top:18%;z-index:40;font-size:28px;letter-spacing:0.2px;opacity:0;transition:opacity 800ms ease, transform 700ms cubic-bezier(.2,.9,.2,1);}
 .msg.glow{color:var(--text-color);text-shadow:0 0 18px rgba(255,210,120,0.85), 0 0 36px rgba(255,150,50,0.45)}
 .flash{position:fixed;inset:0;background:radial-gradient(circle at center, rgba(255,240,200,0.06), rgba(255,200,120,0.02) 25%, rgba(0,0,0,0) 60%);pointer-events:none;mix-blend-mode:screen;z-index:20;opacity:0;transition:opacity 300ms ease;}
 #close{position:fixed;right:14px;top:14px;z-index:50;background:rgba(0,0,0,0.35);color:#fff;padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06)}
 footer{position:fixed;left:12px;bottom:12px;color:#cfcfcf;font-size:12px;z-index:50}
 .sparkle-layer{position:fixed;inset:0;pointer-events:none;z-index:15;mix-blend-mode:screen;opacity:0}
</style>
</head>
<body>
<div id="app">
 <video id="cam" playsinline autoplay muted></video>
 <canvas id="fx"></canvas>

 <div class="overlay">
   <div class="msg" id="msg">Dekha, roshni ho gayi har jagah ✨</div>
   <div class="flash" id="flash"></div>
   <div class="sparkle-layer" id="sparks"></div>
 </div>

 <div class="ui" id="ui">
   <button id="start">Tap when pointing to the sky</button>
   <div class="hint">Point your camera at the sky, then tap. Best after sunset. Allow camera access.</div>
 </div>

 <button id="close" style="display:none">Close</button>
 <footer>— A small surprise</footer>
</div>

<audio id="chime" src="chime.mp3" preload="auto"></audio>

<script>
(async function(){
 const video = document.getElementById('cam');
 const canvas = document.getElementById('fx');
 const ctx = canvas.getContext('2d', { alpha: true });
 const startBtn = document.getElementById('start');
 const msg = document.getElementById('msg');
 const closeBtn = document.getElementById('close');
 const flash = document.getElementById('flash');
 const sparksLayer = document.getElementById('sparks');
 const chime = document.getElementById('chime');

 let particles = [];
 let tiny = [];
 let running=false;
 let w=innerWidth, h=innerHeight;
 function resize(){ w = canvas.width = innerWidth; h = canvas.height = innerHeight; }
 window.addEventListener('resize', resize);
 resize();

 // get camera
 try {
   const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }, audio:false });
   video.srcObject = stream;
 } catch (e) {
   alert('Camera access required. Please allow camera and reload.');
   console.error(e);
   return;
 }

 // particle constructors
 function makeParticle(x,y){
   return {
     x:x + (Math.random()*200-100),
     y:y + (Math.random()*80-200),
     vx:(Math.random()*1.2-0.6),
     vy:(Math.random()*-0.6-1.8),
     life: 80 + Math.random()*140,
     r: 3 + Math.random()*6,
     glow: 0.9 + Math.random()*0.8,
     alpha: 0.8 + Math.random()*0.3
   };
 }
 function makeTiny(x,y){
   return {
     x:x + (Math.random()*300-150),
     y:y + (Math.random()*200-300),
     vx:(Math.random()*0.6-0.3),
     vy:(Math.random()*-0.4-0.8),
     life: 40 + Math.random()*60,
     r: 1 + Math.random()*2,
     glow: 0.6 + Math.random()*0.6
   };
 }

 function spawn(x,y,count=30){
   for(let i=0;i<count;i++) particles.push(makeParticle(x,y));
   for(let i=0;i<count*2;i++) tiny.push(makeTiny(x,y));
 }

 // animation
 function step(){
   ctx.clearRect(0,0,w,h);
   // subtle overlay to keep trails after each frame
   ctx.globalCompositeOperation = 'source-over';
   ctx.fillStyle = 'rgba(0,0,0,0.08)';
   ctx.fillRect(0,0,w,h);

   // large glowing particles (diyas)
   for(let i=particles.length-1;i>=0;i--){
     const p = particles[i];
     p.x += p.vx;
     p.y += p.vy;
     p.vy += 0.006;
     p.life--;
     const g = ctx.createRadialGradient(p.x,p.y,p.r*0.2,p.x,p.y,p.r*12);
     g.addColorStop(0, `rgba(255,245,200,${0.95*p.alpha})`);
     g.addColorStop(0.25, `rgba(255,200,100,${0.75*p.alpha})`);
     g.addColorStop(0.8, `rgba(255,120,50,${0.25*p.alpha})`);
     g.addColorStop(1, `rgba(0,0,0,0)`);
     ctx.globalCompositeOperation = 'lighter';
     ctx.fillStyle = g;
     ctx.beginPath();
     ctx.arc(p.x,p.y,p.r*8,0,Math.PI*2);
     ctx.fill();
     ctx.globalCompositeOperation = 'source-over';
     if(p.life<=0 || p.y < -80 || p.x < -80 || p.x > w+80) particles.splice(i,1);
   }

   // tiny sparkles
   for(let i=tiny.length-1;i>=0;i--){
     const p = tiny[i];
     p.x += p.vx;
     p.y += p.vy;
     p.vy += 0.002;
     p.life--;
     ctx.globalAlpha = 0.9;
     ctx.fillStyle = `rgba(255,230,160,${0.95*p.glow})`;
     ctx.beginPath();
     ctx.arc(p.x,p.y,p.r*3,0,Math.PI*2);
     ctx.fill();
     ctx.globalAlpha = 1;
     if(p.life<=0) tiny.splice(i,1);
   }

   requestAnimationFrame(step);
 }
 step();

 // sparkle HTML layer for extra bloom/glow
 function showSparkleOverlay(){
   sparksLayer.style.opacity = 1;
   sparksLayer.innerHTML = '';
   // create multiple DOM sparks for huge bloom (CSS + opacity handled by blend mode)
   for(let i=0;i<22;i++){
     const s = document.createElement('div');
     const size = 40 + Math.random()*140;
     s.style.position = 'absolute';
     s.style.left = (Math.random()*100)+'%';
     s.style.top = (Math.random()*65)+'%';
     s.style.width = size+'px';
     s.style.height = size+'px';
     s.style.borderRadius = '50%';
     s.style.background = 'radial-gradient(circle, rgba(255,240,200,0.9), rgba(255,180,80,0.35), rgba(255,120,40,0.05))';
     s.style.filter = 'blur(18px)';
     s.style.opacity = 0.0;
     s.style.transform = 'translateY(30px) scale(0.8)';
     s.style.transition = 'all 800ms cubic-bezier(.2,.9,.2,1)';
     sparksLayer.appendChild(s);
     setTimeout(()=>{ s.style.opacity = 1; s.style.transform = 'translateY(0px) scale(1)'; }, 60*i);
   }
   // gradually fade overlay out after a while
   setTimeout(()=>{ sparksLayer.style.opacity = 0; sparksLayer.innerHTML=''; }, 6000);
 }

 // start: spawn bursts & show message/flash
 startBtn.addEventListener('click', function(e){
   if(running) return;
   running = true;
   // sound (user gesture allows autoplay)
   try{ chime.currentTime = 0; chime.play().catch(()=>{}); }catch(err){}
   // center spawn area higher to simulate sky
   const cx = w/2;
   const cy = h * 0.65;
   spawn(cx, cy, 120); // big initial burst
   // cinematic repeated bursts
   let bursts=0;
   const int = setInterval(()=>{
     spawn(cx + (Math.random()*380-190), cy + (Math.random()*40-20), 48);
     bursts++;
     if(bursts>16){ clearInterval(int); finish(); }
   },180);
   msg.classList.add('glow');
   msg.style.opacity = 1;
   msg.style.transform = 'translateY(0) scale(1)';
   flash.style.opacity = 0.14;
   setTimeout(()=>{ flash.style.opacity = 0; }, 700);
   showSparkleOverlay();

   function finish(){
     // final huge burst
     spawn(w/2, h*0.55, 220);
     closeBtn.style.display='block';
     document.getElementById('ui').style.display='none';
   }
 });

 // also allow touch anywhere
 canvas.addEventListener('touchstart', (e)=>{
   if(!running){
     startBtn.click();
   }
 });

 closeBtn.addEventListener('click', ()=>{
   msg.style.opacity=0; msg.style.transform='translateY(-6px) scale(.98)';
   document.getElementById('ui').style.display='none';
   closeBtn.style.display='none';
   running=false;
   particles = []; tiny = [];
 });

})();
</script>
</body>
</html>
